(()=>{document.addEventListener("DOMContentLoaded",function(){var $;chrome.tabs.query({active:!0,currentWindow:!0},function(o){let i=o[0].url;if(/(\/report\/conversion_report|\/payment\/billing\/conversion_details)/.test(i))chrome.scripting.executeScript({target:{tabId:o[0].id},function:Y},s=>{if(console.log("Script execution results:",s),!s||!s[0]){console.error("Kh\xF4ng c\xF3 k\u1EBFt qu\u1EA3 t\u1EEB script"),document.getElementById("result").innerHTML=`
    <div class="alert alert-danger">
    <strong>L\u1ED7i:</strong> Kh\xF4ng th\u1EC3 l\u1EA5y d\u1EEF li\u1EC7u t\u1EEB trang. Vui l\xF2ng \u0111\u1EA3m b\u1EA3o b\u1EA1n \u0111ang \u1EDF trang b\xE1o c\xE1o \u0111\u01A1n h\xE0ng v\xE0 \u0111\xE3 ch\u1ECDn ng\xE0y.
    </div>
    `;return}if(console.log("results[0]:",s[0]),console.log("results[0].result:",s[0].result),!s[0].result){console.error("K\u1EBFt qu\u1EA3 l\xE0 null ho\u1EB7c undefined. results[0]:",s[0]),s[0].error&&console.error("L\u1ED7i t\u1EEB script execution:",s[0].error),document.getElementById("result").innerHTML=`
    <div class="alert alert-danger">
    <strong>L\u1ED7i:</strong> Kh\xF4ng t\xECm th\u1EA5y d\u1EEF li\u1EC7u \u0111\u01A1n h\xE0ng. Vui l\xF2ng ki\u1EC3m tra l\u1EA1i:
    <ul>
    <li>\u0110\xE3 ch\u1ECDn ng\xE0y v\xE0 nh\u1EA5n "T\xECm ki\u1EBFm" ch\u01B0a?</li>
    <li>Trang \u0111\xE3 t\u1EA3i xong ch\u01B0a?</li>
    <li>C\xF3 \u0111\u01A1n h\xE0ng n\xE0o trong kho\u1EA3ng th\u1EDDi gian \u0111\xE3 ch\u1ECDn kh\xF4ng?</li>
    </ul>
    <small>M\u1EDF Console (F12) \u0111\u1EC3 xem chi ti\u1EBFt l\u1ED7i.</small>
    </div>
    `;return}if(s[0].result.error){console.error("L\u1ED7i t\u1EEB calculateAllPages:",s[0].result.message),document.getElementById("result").innerHTML=`
    <div class="alert alert-danger">
    <strong>L\u1ED7i:</strong> ${s[0].result.message||"\u0110\xE3 x\u1EA3y ra l\u1ED7i khi t\xEDnh to\xE1n"}
    </div>
    `;return}let{totalCommission:y,xtraCommission:O,shopeeCommission:g,totalGMV:L,totalOrders:B,canceledOrders:p,unpaidOrders:a,videoOrders:b,liveOrders:h,socialOrders:x,zeroCommissionOrders:F,videoCommission:P,liveCommission:r,socialCommission:c,canceledCommission:n,zeroCommission:m,startDate:v,endDate:d,dateWarning:C}=s[0].result;function N(S){if(!S)return"";let T=S.split("-");if(T.length===3){let[_,w,E]=T;return`${_}/${w}/${E}`}return S}function I(S,T,_,w=null){let E=document.getElementById(S);E&&E.parentElement&&(T>0?(E.parentElement.classList.remove(_),w?E.innerHTML=`<span class="${w}">${T}</span>`:E.textContent=T):E.parentElement.classList.add(_))}let V=N(v),D=N(d);v===d?(document.getElementById("startDate").textContent=V,document.getElementById("endDate").textContent=""):(document.getElementById("startDate").textContent=V,document.getElementById("endDate").textContent=` - ${D}`),C?document.getElementById("dateWarning").style.display="block":document.getElementById("dateWarning").style.display="none",document.getElementById("addlivetagInfo").style.display="block",document.getElementById("CommissionWarning").style.display="block",document.getElementById("totalCommission").textContent=y,document.getElementById("xtraCommission").textContent=O,document.getElementById("shopeeCommission").textContent=g,document.getElementById("totalGMV").textContent=L,document.getElementById("totalOrders").innerHTML=B,document.getElementById("canceledOrders").textContent=p,document.getElementById("unpaidOrders").textContent=a,document.getElementById("videoOrders").textContent=b,document.getElementById("liveOrders").textContent=h,document.getElementById("socialOrders").textContent=x,document.getElementById("zeroCommissionOrders").textContent=F,document.getElementById("totalCommissionCell").textContent=y,document.getElementById("videoCommissionCell").textContent=P,document.getElementById("liveCommissionCell").textContent=r,document.getElementById("socialCommissionCell").textContent=c,document.getElementById("zeroCommissionCell").textContent=m,document.getElementById("canceledCommissionCell").textContent=n,I("canceledOrders",p,"d-none","badge bg-danger"),I("unpaidOrders",a,"d-none","badge bg-secondary"),I("videoOrders",b,"d-none"),I("liveOrders",h,"d-none"),I("socialOrders",x,"d-none"),I("zeroCommissionOrders",F,"d-none","badge bg-warning text-dark"),s[0].result.allOrders&&Q(s[0].result.allOrders)}),document.getElementById("scrollToBottom").addEventListener("click",function(){chrome.scripting.executeScript({target:{tabId:o[0].id},function:j})});else{let s=navigator.language||navigator.userLanguage,y="https://affiliate.shopee.vn";s.startsWith("en")?y="https://affiliate.shopee.com.my":s.startsWith("ph")?y="https://affiliate.shopee.ph":s.startsWith("id")?y="https://affiliate.shopee.co.id":s.startsWith("th")&&(y="https://affiliate.shopee.co.th");let O=new URL(y),g=`${O.origin}/report/conversion_report`,L=`${O.origin}/payment/billing`;document.getElementById("result").style.display="none",document.getElementById("paginationWarning").style.display="none",document.getElementById("scrollToBottom").style.display="none";let B=`
    <div class="alert alert-info mx-2 mb-1 p-1 small" style="border-left: 3px solid #0dcaf0;">
        <h6 class="alert-heading small mb-1">\u{1F4CB} H\u01B0\u1EDBng d\u1EABn s\u1EED d\u1EE5ng</h6>
        <p class="mb-0 small">\u0110\u1EC3 s\u1EED d\u1EE5ng c\xF4ng c\u1EE5 t\xEDnh hoa h\u1ED3ng, vui l\xF2ng l\xE0m theo c\xE1c b\u01B0\u1EDBc sau:</p>
    </div>
    
    <div class="card mb-3 mx-2 small">
        <div class="card-body p-2">
            <h6 class="card-title mb-0 p-0">\u{1F539} C\xE1c b\u01B0\u1EDBc th\u1EF1c hi\u1EC7n:</h6>
            <ol class="mb-0" style="padding-left: 1.5rem;">
                <li class="mb-1">
                    <strong>Truy c\u1EADp trang b\xE1o c\xE1o:</strong>
                    <a href="${g}" target="_blank" class="btn btn-sm btn-primary p-0">
                        ${g}
                    </a>
                    <br>ho\u1EB7c trang \u0111\u1ED1i so\xE1t
                    <a href="${L}" target="_blank" class="btn btn-sm btn-secondary p-0">
                        ${L}
                    </a>
                </li>
                <li class="mb-1">
                    <strong>B\u1EADt th\xF4ng tin b\u1ED5 sung:</strong><br>
                    Nh\u1EA5n v\xE0o bi\u1EC3u t\u01B0\u1EE3ng <span class="badge bg-secondary">\u2699\uFE0F</span> <strong>h\xECnh r\u0103ng c\u01B0a</strong> \u1EDF g\xF3c ph\u1EA3i tr\xEAn v\xE0 b\u1EADt t\xF9y ch\u1ECDn <strong>"Th\xF4ng tin b\u1ED5 sung"</strong>
                </li>
                <li class="mb-1">
                    <strong>Ch\u1ECDn ng\xE0y c\u1EA7n xem:</strong> Ch\u1ECDn ng\xE0y b\u1EA1n mu\u1ED1n xem k\u1EBFt qu\u1EA3. 
                    <div class="alert alert-warning mt-2 mb-0 py-0 px-1" style="font-size: 0.85rem;">
                        <strong>\u{1F4A1} L\u01B0u \xFD:</strong> N\u1EBFu kh\xF4ng th\u1EC3 ch\u1ECDn ng\xE0y h\xF4m qua, h\xE3y ch\u1ECDn ng\xE0y h\xF4m kia tr\u01B0\u1EDBc, sau \u0111\xF3 nh\u1EA5n "T\xECm ki\u1EBFm". L\xFAc n\xE0y, h\u1EC7 th\u1ED1ng s\u1EBD cho ph\xE9p b\u1EA1n ch\u1ECDn l\u1EA1i ng\xE0y h\xF4m qua.
                    </div>
                </li>
                <li class="mb-1">
                    <strong>L\u1ECDc d\u1EEF li\u1EC7u:</strong><br>
                    Nh\u1EA5n n\xFAt <span class="badge bg-success">\u{1F50D} T\xECm ki\u1EBFm</span> \u0111\u1EC3 l\u1ECDc d\u1EEF li\u1EC7u \u0111\u01A1n h\xE0ng
                </li>
                <li class="mb-0">
                    <strong>Xem k\u1EBFt qu\u1EA3:</strong><br>
                    Cu\u1ED1i c\xF9ng, b\u1EA5m v\xE0o bi\u1EC3u t\u01B0\u1EE3ng ti\u1EC7n \xEDch <span class="badge bg-primary">\u{1F4B0}</span> \u1EDF g\xF3c tr\xECnh duy\u1EC7t \u0111\u1EC3 xem k\u1EBFt qu\u1EA3 t\xEDnh to\xE1n
                </li>
            </ol>
        </div>
    </div>
    
    <div class="card mb-3 mx-2">
        <div class="card-body p-2">
            <h6 class="card-title mb-2">\u{1F9F0} Ch\u1EE9c n\u0103ng b\u1ED5 sung:</h6>
            <div class="d-grid gap-2">
                <a href="/order-history.html" target="_blank" class="btn btn-outline-primary btn-sm">
                    \u{1F4E6} Xem l\u1ECBch s\u1EED \u0111\u01A1n h\xE0ng
                </a>
                <a href="/options.html" target="_blank" class="btn btn-outline-info btn-sm">
                    \u2699\uFE0F C\u1EA5u h\xECnh
                </a>
            </div>
        </div>
    </div>
    
    <div class="card mb-3 mx-2">
        <div class="card-body p-2">
            <h6 class="card-title mb-2">\u{1F4DA} T\xE0i li\u1EC7u & H\u1ED7 tr\u1EE3:</h6>
            <div class="d-grid gap-2">
                <a href="https://goink.me/MjsU" target="_blank" class="btn btn-outline-primary btn-sm">
                    \u{1F3A5} Video h\u01B0\u1EDBng d\u1EABn chi ti\u1EBFt
                </a>
                <a href="https://goink.me/ul2i" target="_blank" class="btn btn-outline-info btn-sm">
                    \u{1F465} Tham gia nh\xF3m c\u1ED9ng \u0111\u1ED3ng
                </a>
                <a href="https://goink.me/9enf" target="_blank" class="btn btn-outline-warning btn-sm">
                    \u2B50 VIP: L\u1ECDc theo SubID
                </a>
            </div>
        </div>
    </div>
    
    <div class="alert alert-light border mb-3 mx-2 p-2 small" style="font-size: 0.85rem;">
        <div class="d-flex align-items-center mb-2">
            <span class="me-2">\u{1F310}</span>
            <strong>Xem th\xEAm c\xF4ng c\u1EE5 t\u1EA1i:</strong>
        </div>
        <a href="https://addlivetag.com/" target="_blank" class="text-decoration-none">https://addlivetag.com</a>
    </div>
    <div class="alert alert-success mb-3 mx-2 p-2 small" style="font-size: 0.89rem;">
        \u{1F31F} N\u1EBFu ti\u1EC7n \xEDch n\xE0y gi\xFAp b\u1EA1n ti\u1EBFt ki\u1EC7m th\u1EDDi gian hay t\u1ED1i \u01B0u c\xF4ng vi\u1EC7c, m\xECnh r\u1EA5t mong nh\u1EADn \u0111\u01B0\u1EE3c m\u1ED9t v\xE0i l\u1EDDi nh\u1EADn x\xE9t, \u0111\xE1nh gi\xE1 tr\xEAn Chrome Web Store.<br>
        \u1EE6ng h\u1ED9 b\u1EB1ng m\u1ED9t <strong>\u0111\xE1nh gi\xE1 5 sao</strong> t\u1EEB b\u1EA1n s\u1EBD l\xE0 \u0111\u1ED9ng l\u1EF1c \u0111\u1EC3 m\xECnh ti\u1EBFp t\u1EE5c ph\xE1t tri\u1EC3n th\xEAm nhi\u1EC1u t\xEDnh n\u0103ng m\u1EDBi! \u{1F64F}<br>
        <a href="https://chromewebstore.google.com/detail/shopee-commission-order-c/eodhlockngfflpnhmohlfeaniklalabb" target="_blank" class="btn btn-sm btn-primary mt-2" rel="noopener noreferrer">
            \u2728 \u0110\xE1nh gi\xE1 ti\u1EC7n \xEDch tr\xEAn Chrome Web Store
        </a>
    </div>
    `;document.body.innerHTML+=B}}),($=document.getElementById("captureBtn"))==null||$.addEventListener("click",async function(){try{let o=document.getElementById("captureBtn");o.style.visibility="hidden";let i=document.getElementById("top-shop-product");i.style.display="none";let f=document.getElementById("CommissionWarning");f&&(f.style.display="none"),await new Promise(y=>setTimeout(y,200)),(await html2canvas(document.documentElement,{backgroundColor:"#ffffff",scale:2,logging:!1,useCORS:!0})).toBlob(async function(y){try{let O=new ClipboardItem({"image/png":y});await navigator.clipboard.write([O]);let g=document.createElement("div");g.className="toast-notification",g.textContent="\u0110\xE3 copy \u1EA3nh v\xE0o b\u1ED9 nh\u1EDB \u0111\u1EC7m!",document.body.appendChild(g),setTimeout(()=>{document.body.removeChild(g)},2e3)}catch(O){console.error("Error copying to clipboard:",O),alert("Kh\xF4ng th\u1EC3 copy \u1EA3nh v\xE0o b\u1ED9 nh\u1EDB \u0111\u1EC7m. Vui l\xF2ng th\u1EED l\u1EA1i.")}o.style.visibility="visible",i.style.display="block",f.style.display="block"},"image/png")}catch(o){console.error("Error capturing screenshot:",o),alert("C\xF3 l\u1ED7i khi ch\u1EE5p \u1EA3nh. Vui l\xF2ng th\u1EED l\u1EA1i."),document.getElementById("captureBtn").style.visibility="visible"}})});function j(){window.scrollTo(0,document.body.scrollHeight)}function J($,o){return $?$.length>o?$.slice(0,o)+"...":$:""}function Q($){let o={},i={},f={},s={};$.forEach(p=>{p.orders.forEach(a=>{let b=a.items[0].shop_name||"Kh\xF4ng r\xF5 shop";o[b]=(o[b]||0)+1,i[b]=(i[b]||0)+parseInt(a.items[0].item_commission||0),a.items.forEach(h=>{console.log("item_id:",h.item_id,"name:",h.item_name,"commission:",h.item_commission,"ref:",h.referrer);let x=`${h.item_id}`;f[x]=(f[x]||0)+1,s[x]?s[x].commission+=parseInt(h.item_commission||0):s[x]={name:h.item_name||"S\u1EA3n ph\u1EA9m kh\xF4ng r\xF5",ref:h.referrer||"Kh\xF4ng r\xF5",commission:parseInt(h.item_commission||0)}})})});let g=Object.keys(o).sort((p,a)=>o[a]-o[p]).slice(0,3).map(p=>{let a=o[p],b=i[p];return`${p} \u2014 <strong>${a} \u0111\u01A1n, ${b.toLocaleString("vi-VN",{style:"currency",currency:"VND"})}</strong>`}).join("<br>");document.getElementById("topShop").innerHTML=g;let L=Object.keys(s).sort((p,a)=>s[a].commission-s[p].commission),B=document.getElementById("topProducts");B.innerHTML="",L.slice(0,5).forEach(p=>{let a=s[p],b="MXH";a.ref.includes("Shopeevideo")?b="Video":a.ref.includes("Shopeelive")?b="Live":a.ref&&(b=a.ref);let h=a.commission.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),x=document.createElement("li");x.innerHTML=`${J(a.name,50)} \u2014 <strong>${f[p]} \u0111\u01A1n, ${h} (${b})</strong>`,B.appendChild(x)})}async function Y(){function o(i,f=null){console.log(i,f)}try{let b=function(){document.querySelectorAll(".commission-wrap ul li").forEach(n=>{let m=n.textContent;if(m&&m.includes("Hoa h\u1ED3ng Xtra")){let v=m.split(":");if(v.length>1){let d=v[1].trim(),C=parseFloat(d.replace(/[₫,.]/g,"").replace(/,/g,"."));isNaN(C)||(f+=C)}}}),document.querySelectorAll(".commission-wrap ul li").forEach(n=>{let m=n.textContent;if(m&&m.includes("Hoa h\u1ED3ng t\u1EEB Shopee")){let v=m.split(":");if(v.length>1){let d=v[1].trim(),C=parseFloat(d.replace(/[₫,.]/g,"").replace(/,/g,"."));isNaN(C)||(s+=C)}}})},h=function(){b();let r=document.querySelectorAll(".conversion-report-table tbody tr, .conversion-report-table tr");if(r.length===0&&(r=document.querySelectorAll(".ant-table-tbody tr")),r.length===0){let n=document.querySelector(".conversion-report-table");n&&(r=n.querySelectorAll("tr"))}o(`Scraping data from ${r.length} rows on the current page.`),r.length===0&&(o("Warning: No order rows found. Trying alternative selectors..."),r=document.querySelectorAll("table tbody tr, table tr"),o(`Found ${r.length} rows with alternative selector.`));let c=new Map;r.forEach(n=>{let m=n.querySelector(".shop-details-wrapper>ul>li>span>a"),v=n.querySelector(".item-details-info-wrap .item-details-info-ceils>ul>li>span>a"),d=null,C=n.querySelector(".report-order-details-wrapper .report-table-value-text-medium");if(C)d=C.textContent.trim();else{let e=n.previousElementSibling;for(;e&&!d;){let t=e.querySelector(".report-order-details-wrapper .report-table-value-text-medium");if(t){d=t.textContent.trim();break}e=e.previousElementSibling}}let N=n.querySelector("li.commission-top-bold>span"),I=n.querySelector(".item-details-info-ceils>ul>li:nth-child(2) span"),V=null,D=n.querySelectorAll(".commission-wrap");for(let e of D){let t=e.querySelector(".commission-top:not(.commission-top-bold)");if(t&&!(e.textContent||"").includes("Hoa h\u1ED3ng")){V=t.querySelector("span");break}}let S="0";if(I){let t=I.textContent.trim().match(/Item id:\s*(\d+)/);t&&t[1]&&(S=t[1])}let T=n.querySelectorAll("ul.report-table-ul-8 li"),_="MXH",w=!1;if(d){let e=n.querySelectorAll("span.an-tag");for(let t of e)if(t.textContent.trim()==="\u0110\xE3 h\u1EE7y"){w=!0;break}}else{let e=n.previousElementSibling;for(;e;){let t=e.querySelector(".report-order-details-wrapper .report-table-value-text-medium");if(t?t.textContent.trim():null){let k=e.querySelectorAll("span.an-tag");for(let H of k)if(H.textContent.trim()==="\u0110\xE3 h\u1EE7y"){w=!0;break}break}e=e.previousElementSibling}}let E=!1;for(let e of T){let t=e.querySelector(".report-table-label-large"),l=e.querySelector(".report-table-value-text-large");if(t&&l&&t.textContent.includes("K\xEAnh:")){_=l.textContent.trim(),E=!0;break}}if(!E){let e=n.previousElementSibling;for(;e;){let t=e.querySelectorAll("ul.report-table-ul-8 li");for(let l of t){let k=l.querySelector(".report-table-label-large"),H=l.querySelector(".report-table-value-text-large");if(k&&H&&k.textContent.includes("K\xEAnh:")){_=H.textContent.trim(),E=!0;break}}if(E)break;e=e.previousElementSibling}}let A=null;if(m)A=m.textContent.trim();else{let e=n.previousElementSibling;for(;e;){let t=e.querySelector(".shop-details-wrapper>ul>li>span>a");if(t){A=t.textContent.trim();break}e=e.previousElementSibling}}let u=0;if(V){let t=V.textContent.trim().replace(/[₫,.]/g,"").replace(/,/g,".");t.includes("k")?(t=t.replace("k",""),u=parseFloat(t)*1e3):u=parseFloat(t),isNaN(u)||o(`GMV found for item ${S}: ${u}`)}let W=0;if(N)W=parseFloat(N.textContent.replace(/[₫,.]/g,"").replace(/,/g,"."));else{let e=n.previousElementSibling;for(;e;){let t=e.querySelector("li.commission-top-bold>span");if(t){W=parseFloat(t.textContent.replace(/[₫,.]/g,"").replace(/,/g,"."));break}e=e.previousElementSibling}}if(v&&A){let e=d||`item_${S}`;c.has(e)||c.set(e,{orderId:d,shopName:A,referrer:_,totalCommission:W,items:[],totalGMV:0,isCanceled:!1});let t=c.get(e),l=n.querySelector(".report-order-details-wrapper .report-table-value-text-medium")!==null;w&&l&&!t.isCanceled&&(t.isCanceled=!0,o(`Order ${e} (${d||"no-id"}) marked as CANCELED from first row`)),t.items.push({shop_name:A,item_name:v.textContent.trim(),item_commission:W,item_id:S,referrer:_,item_gmv:u}),t.totalGMV+=u,o(`Added item ${S} to order ${e} (${d||"no-id"}), gmv: ${u}, totalGMV: ${t.totalGMV}, isCanceled: ${w}`)}}),c.forEach(n=>{n.items.forEach(v=>{v.item_gmv=n.totalGMV});let m=n.isCanceled?"CANCELED":"";n.isCanceled&&o(`Pushing CANCELED order: ${n.orderId||"unknown"}, items: ${n.items.length}`),i.push({orders:[{items:n.items,order_status:m}]}),o(`Order ${n.orderId||"unknown"}: ${n.items.length} items, totalGMV: ${n.totalGMV}, isCanceled: ${n.isCanceled}, order_status: ${m}`)})},x=function(r,c,n){let m=0,v=0,d=0,C=0,N=0,I=0,V=0,D=0,S=0,T=0,_=0,w=0,E=0,A=0;return r.forEach(u=>{(u.orders||(u.list?u.list.flatMap(e=>e.orders||[]):[])).forEach(e=>{let t=e.items||[];if(t.length===0)return;let l=t[0],k=parseFloat(l.item_gmv||l.actual_amount||l.item_price||0),H=t.every(M=>parseFloat(M.item_gmv||M.actual_amount||M.item_price||0)===k),G=0,q=0;H&&l.item_gmv?(G=k,q=parseFloat(l.item_commission||0)):t.forEach(M=>{let K=parseFloat(M.item_gmv||M.actual_amount||M.item_price||0);G+=K;let X=parseFloat(M.item_commission||0),U=parseFloat(M.capped_brand_commission||0);q+=X+U});let R=l.referrer||u.referrer||"MXH";v+=G,m+=q,o(`Order: ${t.length} items, GMV: ${G}, Commission: ${q}`),R.includes("Shopeevideo")||R.includes("Shopeevideo-Shopee")?T+=q:R.includes("Shopeelive")||R.includes("Shopeelive-Shopee")?_+=q:w+=q,q===0&&(S++,A+=q);let z=e.order_status||u.checkout_status||"";(z==="CANCELED"||z==="Canceled"||e.cancel_reason)&&(E+=q),d++})}),r.forEach(u=>{(u.orders||(u.list?u.list.flatMap(e=>e.orders||[]):[])).forEach(e=>{let t=e.items||[];if(t.length>0){let l=t[0].referrer||u.referrer||"MXH",k=e.order_status||u.checkout_status||"";l.includes("Shopeevideo")||l.includes("Shopeevideo-Shopee")?I++:(l.includes("Shopeelive")||l.includes("Shopeelive-Shopee"))&&V++,k==="CANCELED"||k==="Canceled"||e.cancel_reason?(C++,o(`Found CANCELED order: orderId=${t[0].item_id||"unknown"}, items=${t.length}, status=${k}`)):(k==="UNPAID"||k==="Pending")&&N++}})}),o(`Total canceled orders counted: ${C}`),D=d-I-V,{totalCommission:m.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),totalGMV:v.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),videoCommission:T.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),liveCommission:_.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),socialCommission:w.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),canceledCommission:E.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),zeroCommission:A.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),xtraCommission:(c/2).toLocaleString("vi-VN",{style:"currency",currency:"VND"}),shopeeCommission:(n/2).toLocaleString("vi-VN",{style:"currency",currency:"VND"}),totalOrders:`${d-C-N} (${d} - <span class="badge bg-secondary">${N}</span> - <span class="badge bg-danger">${C}</span>)`,canceledOrders:C,unpaidOrders:N,videoOrders:I,liveOrders:V,socialOrders:D,zeroCommissionOrders:S}},i=[],f=0,s=0,y=document.querySelector(".ant-calendar-range-picker-input:nth-child(1)"),O=document.querySelector(".ant-calendar-range-picker-input:nth-child(3)"),g=y?y.value:"",L=O?O.value:"",B=g!==L;o("Start and end date values:",{startDate:g,endDate:L,dateWarning:B});async function p(){let r=document.querySelector(".ant-pagination-options-size-changer");if(r&&r.innerText.includes("20 / trang")){o("Found page size changer, switching to 100 entries per page..."),r.click(),await new Promise(n=>setTimeout(n,500));let c=document.querySelectorAll(".ant-select-dropdown-menu-item");for(let n of c)if(n.innerText.includes("100")){n.click(),await new Promise(m=>setTimeout(m,2e3)),o("Switched to 100 entries per page.");break}}}async function a(){let r=document.querySelector(".ant-pagination-prev");if(r&&r.classList.contains("ant-pagination-disabled")===!1){let c=document.querySelector(".ant-pagination-item-1");c&&!c.classList.contains("ant-pagination-item-active")&&(o("Returning to the first page..."),c.click(),await new Promise(n=>setTimeout(n,2e3)))}}async function F(){try{let r=document.querySelector(".ant-pagination-next");if(r&&!r.classList.contains("ant-pagination-disabled"))return r.click(),o("Moving to the next page..."),await new Promise(c=>setTimeout(c,3e3)),h(),await F();{o("Reached the last page. Total orders scraped: "+i.length),o("Total Xtra commission scraped: "+f),o("Total Shopee commission scraped: "+s);let c=x(i,f,s);return o("Calculated results:",c),{...c,startDate:g,endDate:L,dateWarning:B,allOrders:i}}}catch(r){return o("Error in processNextPage:",r),{...x(i,f,s),startDate:g,endDate:L,dateWarning:B,allOrders:i,error:!0,message:r.message||"Error processing pages"}}}await p(),await a(),h(),o("After first page scrape, allOrders length: "+i.length);let P=await F();return o("Final result:",P),!P||typeof P!="object"?(o("Warning: processNextPage returned invalid result, creating default"),{...x(i,f,s),startDate:g,endDate:L,dateWarning:B,allOrders:i}):P}catch(i){return console.error("Error in calculateAllPages:",i),{error:!0,message:i.message||"An error occurred during calculation",totalCommission:"0 \u20AB",xtraCommission:"0 \u20AB",shopeeCommission:"0 \u20AB",totalGMV:"0 \u20AB",totalOrders:"0",canceledOrders:0,unpaidOrders:0,videoOrders:0,liveOrders:0,socialOrders:0,zeroCommissionOrders:0,videoCommission:"0 \u20AB",liveCommission:"0 \u20AB",socialCommission:"0 \u20AB",canceledCommission:"0 \u20AB",zeroCommission:"0 \u20AB",startDate:"",endDate:"",dateWarning:!1,allOrders:[]}}}})();
