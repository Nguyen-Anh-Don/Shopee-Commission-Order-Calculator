(()=>{function N(u){let o=[];return Object.values(u).forEach(s=>{(s.orders||(s.list?s.list.flatMap(r=>r.orders||[]):[])).forEach(r=>{(r.items||[]).forEach(c=>{let m=c.referrer||s.referrer||"";(m.includes("Shopeevideo")||m.includes("Shopeevideo-Shopee"))&&o.push({...s,item:c,order:r})})})}),o}function M(u){let o={};return u.forEach(s=>{let e=s.item,r=String(e.item_id||"");if(r)if(o[r]||(o[r]={productId:r,orders:[],productInfo:null}),o[r].orders.push(s),!o[r].productInfo&&e.batch_item_for_item_card_full&&(o[r].productInfo=e.batch_item_for_item_card_full),o[r].productInfo)!o[r].productInfo.name&&e.item_name&&(o[r].productInfo.name=e.item_name),!o[r].productInfo.image&&(e.image||e.item_image||e.image_url)&&(o[r].productInfo.image=e.image||e.item_image||e.image_url);else{let f=e.item_name||"",c=e.image||e.item_image||e.image_url||"";(f||c)&&(o[r].productInfo={name:f,image:c})}}),o}function k(u){let o=[];return Object.values(u).forEach(s=>{let{productId:e,orders:r,productInfo:f}=s;if(!r||r.length===0)return;let c=0,m=0,V=0,n=null,l=null,g=new Map;r.forEach(i=>{let t=i.item;if(!t)return;let O=`${i.checkout_id||i.order&&i.order.order_id||i.purchase_time||Date.now()}_${t.item_id}`;if(g.has(O))return;g.set(O,i);let d=i.purchase_time||i.checkout_complete_time||0,y=0,v=0;if(t.item_gmv)y=parseFloat(t.item_gmv||0)/1e5,v=parseFloat(t.item_commission||0)/1e5;else{y=parseFloat(t.actual_amount||0)/1e5;let C=parseFloat(t.item_commission||0),S=parseFloat(t.capped_brand_commission||0);v=(C+S)/1e5}c+=y,m+=v,V++,d>0&&((!n||d<n)&&(n=d),(!l||d>l)&&(l=d))});let _=`S\u1EA3n ph\u1EA9m ${e}`,a="",p=!1,h=!1;for(let i of r){let t=i.item;if(!p&&t.batch_item_for_item_card_full&&t.batch_item_for_item_card_full.name?(_=t.batch_item_for_item_card_full.name,p=!0):!p&&t.item_name&&_===`S\u1EA3n ph\u1EA9m ${e}`&&(_=t.item_name),!h&&t.img_code?(a=`https://cf.shopee.vn/file/${t.img_code}`,h=!0):!h&&!a&&(t.image?a=`https://cf.shopee.vn/file/${t.image}`:t.item_image?a=`https://cf.shopee.vn/file/${t.item_image}`:t.image_url&&(a=t.image_url.startsWith("http")?t.image_url:`https://cf.shopee.vn/file/${t.image_url}`)),p&&h)break}o.push({productId:e,productName:_,productImage:a,orderCount:V,totalGMV:c,totalCommission:m,firstOrderDate:n?new Date(n*1e3):null,lastOrderDate:l?new Date(l*1e3):null,orders:Array.from(g.values()),formatted:{totalGMV:c.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),totalCommission:m.toLocaleString("vi-VN",{style:"currency",currency:"VND"}),firstOrderDate:n?new Date(n*1e3).toLocaleDateString("vi-VN"):"N/A",lastOrderDate:l?new Date(l*1e3).toLocaleDateString("vi-VN"):"N/A"}})}),o.sort((s,e)=>s.orderCount===0&&e.orderCount>0?1:s.orderCount>0&&e.orderCount===0?-1:e.orderCount-s.orderCount),o}typeof window<"u"&&(window.getVideoOrders=N,window.groupOrdersByProduct=M,window.calculateVideoOverviewStats=k);})();
